<app-main-pane>
    <ng-container header>
        <!-- <div class="header-border | absolute bottom-0 h-[1px] w-full bg-tinted-800 transition-opacity" -->
        <!--     [class.opacity-0]="!isScrolled && !isSecondaryProgressBarVisible"></div> -->

        <div
            class="header-progress | absolute bottom-0 left-0 h-[2px] bg-submit-500 transition-opacity"
            [class.opacity-0]="!isPrimaryProgressBarHidden"
            [style.width]="progress + '%'"
        ></div>

        <app-breadcrumbs [breadcrumbs]="(breadcrumbs$ | async) || []"></app-breadcrumbs>

        <div cdkMenuBar>
            <button
                cdkMenuItem
                class="button-icon-naked menu-item | py-2 px-4"
                [cdkMenuTriggerFor]="options"
                #trigger="cdkMenuTriggerFor"
            >
                <app-icon iconClass="fas fa-ellipsis-v"></app-icon>
            </button>

            <ng-template #options>
                <app-drop-down
                    [items]="(entityOptionsItems$ | async) || []"
                    [rootTrigger]="trigger"
                    [data]="(activeEntity$ | async)?.id"
                ></app-drop-down>
            </ng-template>
        </div>

        <app-menu-toggle></app-menu-toggle>
    </ng-container>

    <ng-container main>
        <div #top></div>
        <div class="mb-4" *ngIf="activeEntity$ | async as activeEntity">
            <!-- <div class="flex gap-1 text-tinted-300 opacity-0 transition-opacity group-hover:opacity-100"> -->
            <!--     <button class="button-naked">Add Sublist</button> -->
            <!--     <button class="button-naked">Add Description</button> -->
            <!-- </div> -->
            <!-- dont know 'bout these ones: -->
            <!-- <button class="button-naked">Add Task</button> -->
            <!-- <button class="button-naked">Share</button> -->

            <h1 class="heading | mt-4">
                <page-entity-icon class="mr-2.5 inline-block -translate-y-0.5 text-2xl" [icon]="EntityType.TASKLIST">
                </page-entity-icon>

                <span
                    class="title | inline-block min-w-[2rem] cursor-text outline-none"
                    [innerText]="activeEntityName$ | async"
                    [class.show-placeholder]="!(entityNameDomState$ | async)"
                    [attr.data-placeholder]="DEFAULT_TASKLIST_NAME"
                    #editableEntityName
                    contenteditable
                    focusable
                    #entityNameFocusable="focusable"
                    [spellcheck]="entityNameFocusable.isFocused"
                    (textChanges)="entityNameChanges$.next($event)"
                    [mutationOptions]="{ plainOnly: true, observe: entityNameFocusable.isFocused }"
                    (keydown)="keydownEvents$.next($event)"
                    (blur)="blurEvents$.next($event)"
                ></span>
            </h1>

            <div class="description | text-tinted-300 outline-none" contenteditable>
                <p>And this is the part for the description</p>
                <p>Where you can</p>
                <ul>
                    <li>Describe the list/task in further detail</li>
                    <li>Take notes for yourself</li>
                    <li>Quickly write down / sketch out ideas</li>
                </ul>
            </div>

            <div class="children | mt-5 flex items-center gap-3" cdkMenuBar>
                <button
                    class="button-naked text-tinted-200 hover:text-tinted-100"
                    appTooltip="Create a new list inside this one"
                    (click)="createNewSublist()"
                    cdkMenuItem
                >
                    <app-icon iconClass="fas fa-plus" class="mr-1"></app-icon>
                    New sublist
                </button>

                <div class="flex flex-wrap gap-2" *ngIf="activeEntity.children.length; else noChildren">
                    <button
                        class="child | button-m text-tinted-200"
                        *ngFor="let child of activeEntity.children"
                        routerLink="/home/{{ child.id }}"
                        cdkMenuItem
                        [cdkContextMenuTriggerFor]="options"
                        #trigger="cdkContextMenuTriggerFor"
                    >
                        <app-entity-page-label
                            [title]="child.name"
                            [pageIcon]="EntityType.TASKLIST"
                        ></app-entity-page-label>

                        <ng-template #options>
                            <app-drop-down
                                [items]="(entityOptionsItems$ | async) || []"
                                [rootTrigger]="trigger"
                                [data]="child.id"
                            ></app-drop-down>
                        </ng-template>
                    </button>
                </div>

                <ng-template #noChildren>
                    <p class="m-0 text-tinted-500">
                        <app-icon iconClass="fas fa-genderless" class="mr-1 inline-block translate-y-px"></app-icon> No
                        lists inside
                    </p>
                </ng-template>
            </div>
        </div>

        <div
            class="progress-container | group sticky -top-3 z-30 mb-5 flex items-center gap-2 bg-tinted-900 pt-4 pb-3 shadow-header"
        >
            <div
                #progressBar
                class="progress | h-1.5 grow rounded bg-tinted-700 transition-colors group-hover:bg-tinted-600"
                appTooltip="{{ progress }}% closed - {{ closedTasks }}/{{ allTasks }}"
                [tooltipOptions]="{ closeOnHostClick: false }"
            >
                <div class="h-full rounded bg-submit-400 transition-shadow" [style.width]="progress + '%'"></div>
            </div>
            <button
                class="text-sm text-tinted-600 transition-colors group-hover:text-submit-400"
                (click)="isShownAsPercentage = !isShownAsPercentage"
            >
                {{ isShownAsPercentage ? progress + '%' : closedTasks + ' / ' + allTasks }}
            </button>
        </div>

        <app-tasks-demo></app-tasks-demo>
    </ng-container>
</app-main-pane>
